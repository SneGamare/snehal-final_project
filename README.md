package com.kotak.orchestrator.orchestrator.serializer;


import com.kotak.orchestrator.orchestrator.schema.PlutusFinacleData;
import org.apache.commons.codec.DecoderException;
import org.apache.commons.codec.binary.Hex;
import org.apache.kafka.common.errors.SerializationException;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThatThrownBy;
import static org.assertj.core.api.AssertionsForClassTypes.assertThat;

public class PlutusFinacleDeserializerTest {

    private PlutusAvroDeserializer<PlutusFinacleData> plutusAvroDeserializer;

    @BeforeEach
    public void setUp() {
        plutusAvroDeserializer = new PlutusAvroDeserializer<PlutusFinacleData>(PlutusFinacleData.class);

    }

    
    @Test
    void avroDeserialize_plutus_success() throws DecoderException {
        String hexEvent =
                "02143132333435363738393402104a6f686e20446f650214323032342d30332d32300214323032342d30332d323002105452313233343537020a505431323302024e0204435202065354310206505431020a474c313233020a41433132330214323032342d30332d3230020000000000448f40021c53616c617279205061796d656e740214323032342d30332d32300214323032342d30332d3230020c52454631323302064954310214323032342d30332d3230020a494e313233021c4d6f6e74686c792053616c617279020e43555354313233020a425230303102065553440206555344020000000000448f40020c534f4c313233020a424b303031020a545231323300";
        PlutusFinacleData deserializeEvent =
                plutusAvroDeserializer.deserialize("dtd-business-event", Hex.decodeHex(hexEvent));
        assertThat(deserializeEvent).isNotNull();
        assertThat(deserializeEvent.getForacid()).isEqualTo(1234567894);
         }
     

    @Test
    void avroDeserialize_differentSchemaEventPassed_Failure() throws DecoderException {
        String hexEvent =
                "0202164b4d31343039313635363102025902024e02083134313002043036021220343732383539333800021430363437323835393338023243686574616e205669736877616e617468204b617370616c6502144a494649204143434f550210524532333938313900020a3132303438020243020a534a49464e020000000080841e41020a5344494749020220000226323032342d30312d32352030303a30303a303002024e00020000000000000000020402000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000202590200000000804f124102faff8f1ec4bcd64202faff8f1ec4bcd642020000000080842e4102faff8f1ec4bcd64202faff8f1ec4bcd642020000000080842e4102faff8f1ec4bcd64202faff8f1ec4bcd64202000000000000000002000000000000000002000000000000000000020630303902024e0202590002025902024e02063030330226323032332d30392d30352030303a30303a303002000000000000000002025902025900025032323844394439464639464238423937423944383042413243383643394436363634433539334446020c4649565553520226323032342d30322d32302031363a34343a3335020c3135323038390226323032332d30392d30362031363a30303a3037000202200200000000000000000202200226323032332d30392d30352030303a30303a3030020000000000000000000200000000000000000200000000000000000002000000000000000002000000000000000000000202200206494e5202000000000000000002022002022002024e020000000000000000020220020259000226323032342d30312d32342030303a30303a3030020a4d4257414c02065342410226323032332d30392d30362030303a30303a303000020000000000000000020220020000000000000000020000000000000000000202200202200002024e0226313930302d30312d30312030303a30303a303002024e020220020220000000000002120002024e0200020000000000000000020000000000000000020220020a5342524553000002000000000088c3400200000000000000000200000000000000000200000000000000000200000000000000000202200202200226323032342d30322d32302030303a30303a3030021237303637393039393802000000000000000002000000000000000002000000000000000002000000000000000002000000000000000002000000000000000002000000000000000000000002000000000000000002000000000000000000020430310000000002024e0002043030020220000002022002025902000200000002024e02022002024e00000000020245020220020220000000000202200202200200000000000000000202410200000200000000000000000200000000000000000202164b4d31343039313635363102025902024e02083134313002043036021220343732383539333800021430363437323835393338023243686574616e205669736877616e617468204b617370616c6502144a494649204143434f550210524532333938313900020a3132303438020243020a534a49464e020000000080841e41020a5344494749020220000226323032342d30312d32352030303a30303a303002024e00020000000000000000020402000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000200000000000000000202590200000000804f124102faff8f1ec4bcd64202faff8f1ec4bcd642020000000080842e4102faff8f1ec4bcd64202faff8f1ec4bcd642020000000080842e4102faff8f1ec4bcd64202faff8f1ec4bcd64202000000000000000002000000000000000002000000000000000000020630303902024e0202590002025902024e02063030330226323032332d30392d30352030303a30303a303002000000000000000002025902025900025032323844394439464639464238423937423944383042413243383643394436363634433539334446020c4649565553520226323032342d30322d32302031363a34343a3530020c3135323038390226323032332d30392d30362031363a30303a3037000202200200000000000000000202200226323032332d30392d30352030303a30303a3030020000000000000000000200000000000000000200000000000000000002000000000000000002000000000000000000000202200206494e5202000000000000000002022002022002024e020000000000000000020220020259000226323032342d30312d32342030303a30303a3030020a4d4257414c02065342410226323032332d30392d30362030303a30303a303000020000000000000000020220020000000000000000020000000000000000000202200202200002024e0226313930302d30312d30312030303a30303a303002024e020220020220000000000002120002024e0200020000000000000000020000000000000000020220020a5342524553000002000000000088c3400200000000000000000200000000000000000200000000000000000200000000000000000202200202200226323032342d30322d32302030303a30303a3030021237303637393039393802000000000000000002000000000000000002000000000000000002000000000000000002000000000000000002000000000000000002000000000000000000000002000000000000000002000000000000000000020430310000000002024e0002043030020220000002022002025902000200000002024e02022002024e0000000002024502022002022000000000020220020220020000000000000000020241020000020000000000000000020000000000000000";
        assertThatThrownBy(() -> plutusAvroDeserializer.deserialize("cros-account-master-events", Hex.decodeHex(hexEvent)))
                .isInstanceOf(SerializationException.class);
    }
}
